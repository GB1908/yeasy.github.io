<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
<title> gnuplot / webplot / access_log </title>
<!-- Generated 2000/ 2/17 -->
<!-- $Id: access_log.html,v 1.8 2004/12/04 10:02:08 kawano Exp $ -->
<meta http-equiv="content-type" content="text/html;charset=iso-2022-jp">
<link rel="stylesheet" href="../style-new.css" type="text/css">
</head>

<body>

<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr><td bgcolor="#cccc90" width="320">
    <div align="left">
    <a href="../index.html">
    <img src="../image/gnuplot_logo2.png" alt="GNUPLOT" width="320" height="90">
    </a></div></td>
    <td bgcolor="#cccc90">
      <div align="center"><h3> - not so Frequently Asked Questions - </h3> </div>
      <div class="update"> update 2004/11/29 </div>
    </td>
</tr>
<tr><td bgcolor="#fae8ba"></td>
    <td bgcolor="#fae8ba"><div class="navi"> 
<a href="../index.html">          HOME </a> |
<a href="../intro/index.html">    INTRODUCTION </a> |
<a href="../general.html">        INFORMATION </a> |
<a href="../gallery/index.html">  GALLERY </a> |
<a href="access_log-e.html">           ENGLISH </a>
</div></td></tr>
</table>
<hr class="topsep">


<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr><td id="menu">
 <p> <a href="index.html">   WWW Access Log  </a></p>

 <ul>
  <li><a href="access_log.html"> access_logの解析・集計 </a>
  <li> 集計結果のプロット
   <ul>
    <li><a href="access_plot.html">定期的に集計 </a> 
    <li><a href="access_cgi.html"> CGIて集計 </a>
   </ul>
 </ul>
</td>

<td id="content">


<h1><a name="top"> httpd access_logの解析・集計 </a></h1>

<p> apacheのlogfileの集計を簡単にするために，このファイルが毎月新しく
作り直されている状況を考えます．logファイルはすぐに巨大になってしまう
ので，多くのWWW Serverではこの処理を自動的に行っているはずです．</p>

<p> apacheのaccess_logは，標準では次のようになっています．</p>

<pre class="file">
host.domain - - [01/Jan/2000:01:23:45 +0900] "GET /index.html HTTP/1.1" 200 1548
host.domain - - [01/Jan/2000:01:23:50 +0900] "GET /icons/mail.png HTTP/1.1" 200 229
</pre>

<p>まずは，細かいことは無視して，何日にいくつのアクセスがあったのか，
だけを数えましょう．必要なのは，<tt> [01/Jan/2000: </tt> の中の01の部
分です．同じ日のアクセスを1日から31日までに対してそれぞれ合計します．</p>

<pre class="file">
#!/usr/bin/perl
while(&lt;&gt;){
    if(/\.html/){
        split;
        $day = substr($_[3],1,2);
        $count[$day]++;
    }
}
for($i=1;$i&lt;=$#count;$i++){
    printf("%10d %10d\n",$i,$count[$i]);
}
</pre>

<p> access_logには全てのファイルへのアクセスが記録されますので，画像ファ
イル等へのアクセス数をカウントしないように，htmlが付く行のみを処理して
います．特定のURLだけをカウントするなら，ifの部分をもう少ししっかり作る
必要があります．</p>

<p>まず各行の要素を，スペースで分割し，日にちの部分を<tt>substr</tt>を
使って切りだします．これを変数<tt>$day</tt>に代入し，<tt>$day</tt>日の
カウンタを一つ増やします．ファイルを全部読み終えたら，日にち毎のカウン
ト数を書き出します．上のperlのスクリプトを webplot.plという名前にして
おきます．</p>



<p>これは某所サーバへの2000年1月のアクセスの集計結果です．</p>
<pre class="file">
         1       172
         2       321
         3       208
         4       279
         5       327
      ....      ....
        25       588
        26      1038
        27       848
        28       772
        29       570
        30       495
        31       548
</pre>

<p>この結果をファイルにdumb terminalを使ってプロットすると，次のように
なります．ここで "&lt; webplot.pl access_log" の最初の不等号は，perlの
プログラムの<a href="../datafile2.html#7.6">処理結果をプロットするデー
タとして読み込む</a>ことを表します．</p>

<pre class="sample">
gnuplot&gt; set term dumb
Terminal type set to 'dumb'
Options are 'feed 79 24'
gnuplot&gt; plot "&lt; webplot.pl access_log" with step


 1600 ++--------+---------+---------+---------+---------+---------+--------++
      +         +         +         +      "&lt; webplot.pl access_log" ****** +
 1400 ++                                            ***                    ++
      |                                             * *                     |
      |                                             * *                     |
 1200 ++                                            * *                    ++
      |                                             * *                     |
 1000 ++                                  ***       * *   ***              ++
      |                                   * *       * *   * *               |
      |                                   * *       * *   * ***             |
  800 ++                                  * *       * *   *   ***          ++
      |                                   * * ***   * *   *     *           |
  600 ++                    ***           * *** *   * *   *     *          ++
      |             ***     * *           *     *** * *****     *** *       |
      |             * *     * *******     *       * *             ***       |
  400 ++            * *     *       *** ***       ***                      ++
      |   ***   *** * * *****         * *                                   |
  200 ++  * ***** *** ***             ***                                  ++
      | ***                                                                 |
      +         +         +         +         +         +         +         +
    0 ++--------+---------+---------+---------+---------+---------+--------++
      0         5        10        15        20        25        30        35
</pre>


<div class="top"><a href="access_log.html#top"><img src="../image/mark-up.png" alt="up"></a></div>

</td></tr></table>
<hr class="topsep">

</body>
</html>
