<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
<title> gnuplot / datafile (2)</title>
<!-- Generated 1999/ 8/31 -->
<!-- $Id: datafile2.html,v 1.17 2005/11/20 08:04:36 kawano Exp $ -->
<meta http-equiv="content-type" content="text/html;charset=iso-2022-jp">
<meta http-equiv="content-style-type" content="text/css">
<link rel="stylesheet" href="style-new.css" type="text/css">
</head>
<body>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr><td bgcolor="#cccc90" width="320">
    <div align="left">
    <a href="index.html">
    <img src="image/gnuplot_logo2.png" alt="GNUPLOT" width="320" height="90">
    </a></div></td>
    <td bgcolor="#cccc90">
      <div align="center"><h3> - not so Frequently Asked Questions - </h3> </div>
      <div class="update"> update 2008/08/21 </div>
    </td>
</tr>
<tr><td bgcolor="#fae8ba"></td>
    <td bgcolor="#fae8ba"><div class="navi"> 
<a href="index.html">           HOME </a> |
<a href="intro/index.html">     INTRODUCTION </a> |
<a href="general.html">         INFORMATION </a> |
<a href="gallery/index.html">   GALLERY </a> |
<a href="datafile2-e.html">     ENGLISH </a>
</div></td></tr>
</table>
<hr class="topsep">


<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr><td id="menu">
 <p> not so FAQ</p>
  <ul>
    <li><a href="legend.html">      凡例(Legend) </a>
    <li><a href="tics.html">        目盛(Tics) </a>
    <li><a href="label.html">       ラベル(Label) </a>
    <li><a href="plot1.html">       2次元プロット </a>
    <li><a href="plot3d.html">      3次元プロット </a>
    <li><a href="polar.html">       極座標プロット </a>
    <li><a href="parametric.html">  媒介変数表示 </a>
    <li><a href="datafile.html">    データファイルの数値 </a>
    <ul>
      <li><a href="datafile.html#7.1">
           データフォーマット </a>
      <li><a href="datafile2.html#7.2">
           複数のデータをプロット</a>
      <li><a href="datafile2.html#7.3">
           数値の修正 </a>
      <li><a href="datafile2.html#7.4">
           データとコマンドの共存 </a>
      <li><a href="datafile2.html#7.5">
           データをスキップ </a>
      <li><a href="datafile2.html#7.6">
           一部をプロット</a>
      <li><a href="datafile3.html#7.7">
           UNIXのコマンド </a>
      <li><a href="datetime.html">
           日付/時間型データ </a>
    </ul>
    <li><a href="postproc.html">    図を描いたその後は</a>
    <li><a href="misc1.html">       その他 </a>
  </ul>
 <br>
</td>


<td id="content">


<h1><a name="top"> データファイルの数値のプロット (その2) </a></h1>

<div align="center">
<a href="datafile.html">  1 </a> | 
<a href="datafile2.html"> 2 </a> | 
<a href="datafile3.html"> 3 </a> |
<a href="datetime.html">  4 </a>
</div>



<h2><a name="7.2">一つのファイルに入った複数のデータをプロットするには？</a></h2>

<p> 一つのファイルに複数のデータを書いてそれらを同時にプロットするには，
usingとindexを使います．</p>

<p>X座標が同じでY座標が異なるデータをプロットするときは，データを表形
式で表して，usingでプロットするデータを指定するのが簡単です．</p>

<pre class="file">
#   X         Y1         Y2         Y3
   -1.0000    0.0000     0.0000     1.0000
   -0.9000    0.5700     1.1769     0.7150
   -0.8000    1.0800     1.4400     0.4600
   -0.7000    1.5300     1.4997     0.2350
   -0.6000    1.9200     1.4400     0.0400
   -0.5000    2.2500     1.2990    -0.1250
   -0.4000    2.5200     1.0998    -0.2600
   -0.3000    2.7300     0.8585    -0.3650
   -0.2000    2.8800     0.5879    -0.4400
   -0.1000    2.9700     0.2985    -0.4850
    0.0000    3.0000    -0.0000    -0.5000
    0.1000    2.9700    -0.2985    -0.4850
    0.2000    2.8800    -0.5879    -0.4400
    0.3000    2.7300    -0.8585    -0.3650
    0.4000    2.5200    -1.0998    -0.2600
    0.5000    2.2500    -1.2990    -0.1250
    0.6000    1.9200    -1.4400     0.0400
    0.7000    1.5300    -1.4997     0.2350
    0.8000    1.0800    -1.4400     0.4600
    0.9000    0.5700    -1.1769     0.7150
    1.0000    0.0000    -0.0000     1.0000
</pre>

<pre class="sample">
gnuplot&gt; plot "test.dat" using 1:2 with lines,\
              "test.dat" using 1:3 with lines,\
              "test.dat" using 1:4 with lines
</pre>

<div align="center"><img src="fig/sample7.2a.png" alt="fig/sample7.2a" width="232" height="230"></div>


<p>X座標が異なる場合は，複数のデータを2行の空行で区切ってブロックにす
る方法を使います．(注：ここでいうブロックとは，gnuplotのマニュアルにあ
るdatablockとは異なり，通常の意味でのデータのかたまりを指します．
gnuplotでは1行の空行で区切られたデータのかたまりをblockと定義してます)
</p>

<pre class="file">
#  X     Y     Yerror
   1.0   1.2   0.1
   2.0   1.8   0.1
   3.0   1.6   0.1


   1.1   0.8   0.2
   2.1   0.3   0.2
   3.1   1.0   0.2


   1.2   1.5   0.3
   2.2   2.3   0.3
   3.2   3.1   0.3
</pre>

<pre class="sample">
gnuplot&gt; plot "test.dat" using 1:2 with lines
</pre>

<div align="center"><img src="fig/sample7.2b.png" alt="fig/sample7.2b" width="302" height="231"></div>

<pre class="sample">
gnuplot&gt; plot "test.dat" using 1:2:3 with yerrorbars
</pre>

<div align="center"><img src="fig/sample7.2c.png" alt="fig/sample7.2c" width="303" height="224"></div>

<p> ここの例で分かるように，データをブロックにしてプロットした場合，
全部が同じ線種・記号で表示されます．各ブロックに対して異なる線種・
記号を与えるには，それぞれのブロックのindexを使います．
初めのブロックのindexは0，次のブロックは1，という順序で，indexが
与えられており，これを指定してプロットします．</p>

<pre class="sample">
gnuplot&gt; plot "test.dat" index 0 using 1:2:3 with yerrorbars,\
              "test.dat" index 1 using 1:2:3 with yerrorbars,\
              "test.dat" index 2 using 1:2:3 with yerrorbars
</pre>

<div align="center"><img src="fig/sample7.2d.png" alt="fig/sample7.2d" width="301" height="231"></div>

<p> indexは範囲を指定することもできます．上の例で，index 0とindex 1に
同じ記号を使い，2だけを変えるには，次のようにします．</p>

<pre class="sample">
gnuplot&gt; plot "test.dat" index 0:1 using 1:2:3 with yerrorbars,\
              "test.dat" index 2   using 1:2:3 with yerrorbars
</pre>

<div align="center"><img src="fig/sample7.2e.png" alt="fig/sample7.2e" width="302" height="232"></div>




<h2><a name="7.3">ファイルの数値をプロットする時に，数値を修正したい．</a></h2>

<p> usingの後に指定するカラムに簡単な演算ができます．プロットする
データとして次のものを用い，Y座標をそのまま，Y座標の値を2倍したもの，
平方根をとったもの，対数をとったもの，を同時にプロットしてみます．</p>

<pre class="file">
#  X     Y
   1.0   1.2
   2.0   1.8
   3.0   1.6
</pre>

<pre class="sample">
gnuplot&gt; plot "test.dat" using 1:2          with points,\
              "test.dat" using 1:($2*2)     with points,\
              "test.dat" using 1:(sqrt($2)) with points,\
              "test.dat" using 1:(log($2))  with points
</pre>

<img src="fig/sample7.3.png" alt="fig/sample7.3" align="left" width="297" height="232">

<p> $nで，nカラムのデータを指定し，それに演算を施します．このとき計算
式は必ず()で括ります．<tt> using 1:sqrt($2) </tt>の様な書き方はエラーに
なります．同じ方法を使って複数のカラムの演算結果をプロットすることもで
きます．例えば2カラムと3カラムの積をプロットするには，
<tt>using 1:2:($2*$3)</tt>とします．</p>
<br clear="all">

<p> この方法は誤差付きデータを表示するときに便利なことがあります．
gnuplotでは，誤差を絶対値で与えますが，データファイルにはパーセント
のような相対値で表示されていることが少なくありません．<tt>using
1:2:($2*$3/100.0)</tt>とすれば，ファイルの中身を書き直すことなく%表示
のデータをプロットすることができます．</p>




<h2><a name="7.4">データファイルにプロットのコマンドも一緒に入れたい．</a></h2>

<p>gnuplotではプロットするデータのファイルと，実行するコマンドを記述し
たファイルは独立ですが，単純なデータなら一つのファイルに入れてしまうこ
とができます．基本的には，コマンドが記述されたファイルを作ってバッチ処
理する方法ですが，このファイルのplotコマンド部分に，プロットするファイ
ル名として "-" を指定し，その後に数値データを書きます．データの終りは 
"e" で始まる行です．</p>


<pre class="file">
set xrange [0:5]
set yrange [0:3]
plot "-" using 1:2:3 w yerrorbars
#  X     Y     Z 
   1.0   1.2   0.2
   2.0   1.8   0.3
   3.0   1.6   0.2
   4.0   1.2   0.2
end
pause -1
</pre>

<p> このようなデータ込みのgnuplot制御用ファイルを用意し，gnuplot
の起動時にコマンドラインオプションでファイル名を与えます．</p>

<pre class="sample">
 % gnuplot "test.plt"
</pre>

<p> 但し，この方法ではreplotコマンドは使えません．gnuplotはデータを記
憶しないので，replotとすると，再び標準入力からデータを読み込もうとしま
す．</p>




<h2><a name="7.5">特定のデータをスキップしてプロットしたい．</a></h2>

<p> ファイル中の幾つかのデータを消してしまいたい場合があります．plot時
にデータのスキップを指定するには <a href="datafile2.html#7.6"><tt> every </tt> を使
う方法</a>と，データファイルを直接編集する方法があります．ここでは編集
する方法を説明します．スキップしたい数値の前に，何か適当な文字(例えば
"?"等)を入れると，そこは読み飛ばされます．勿論，数値自体を文字で置き換
えても構いません．本当は，データを読み飛ばずための文字は，<tt> set
missing </tt>で指定された文字の筈なのですが，数字に変換出来ない文字な
らなんでも良いようです．</p>

<p>下の2つの例の様に，(X,Y1)と(X,Y2)のグラフを描く場合を考えます．</p>

<table border="1">
<tr><td> test1.dat </td>
    <td> test2.dat </td></tr>
<tr>
<td style="{background-color:#ffffff;width:320;}"><pre>
#  X     Y1    Y2
   1.0   1.2   1.5
  ?2.0   1.8   0.8
   3.0   1.6   1.1
</pre></td>
<td style="{background-color:#ffffff;width:320;}"><pre>
#  X     Y1    Y2
   1.0   1.2   1.5
   2.0   1.8  ?0.8
   3.0   1.6   1.1
</pre></td></tr>
</table>

<p>左の例ではX座標に?が付いていおり，2番目のデータである(2.0,1.8)と
(2.0,0.8)の2つの点が読み飛ばされます．右の例では(2.0,1.8)の組は生きて
おり，(2.0,0.8)だけが消されます．</p>

<pre class="sample">
gnuplot&gt; plot "test1.dat" using 1:2 with linespoints,\
              "test1.dat" using 1:3 with linespoints
</pre>

<div align="center"><img src="fig/sample7.5a.png" alt="fig/sample7.5a" width="400" height="300"></div>

<pre class="sample">
gnuplot&gt; plot "test2.dat" using 1:2 with linespoints,\
              "test2.dat" using 1:3 with linespoints
</pre>

<div align="center"><img src="fig/sample7.5b.png" alt="fig/sample7.5b" width="400" height="300"></div>



<p>この機能は，データが表形式になっているときに，各カラムでの表示範囲
を変えたい場合に便利です．例えば，次のようなデータがあり，このY1,Y2を
同時に対数プロットする場合を考えます．</p>

<pre class="file">
#  X     Y1    Y2
   1.0   0.0   0.1
   2.0   0.0   0.1
   3.0   0.0   0.1
   4.0   0.1   0.2
   5.0   0.6   0.4
   6.0   1.0   0.9
   7.0   1.2   1.7
   8.0   1.3   2.4
</pre>

<p>Y1はXが[1:3]の範囲で0なので対数にはなりません．gnuplotはこの場合，
プロット出来る最後の点(ここではX=4)から下に真直な線を引きます．</p>

<div align="center"><img src="fig/sample7.5c.png" alt="fig/sample7.5c" width="400" height="300"></div>

<p>この鉛直線を消すには，Y1=0.0の部分にプロット出来ない文字を書き込み
ます．例えばゼロの部分を "?0.0" に変えてプロットすると，Y1のデータ(赤
い線)はX=4から始めることができます．同様のことは，plotコマンドで，
<tt> every ::3 </tt>を指定しても出来ます．</p>

<div align="center"><img src="fig/sample7.5d.png" alt="fig/sample7.5d" width="400" height="300"></div>




<h2><a name="7.6">ファイルの一部だけをプロットしたい．</a></h2>

<p> データファイル中で，プロットするデータの範囲(データファイル中の行)を
指定するには，plotコマンドで<tt>every</tt>というキーワードを使います．
例えば<tt> plot "test.dat" every 2 </tt>なら一行おきにプロットします．</p>

<p>データファイルが1行の空行で区切られた幾つかのデータブロックに分かれている
場合も，everyによってデータブロックの読み飛ばしを指定できます．<tt> every :2
</tt>ならデータブロックを一つおきにプロットします．</p>

<div align="center"><table border="0">
<tr><td> every I:J:K:L:M:N </td>
    <td>
      <table border="1" class="incontent">
         <tr> <td>I </td><td>行の増分</td></tr>
         <tr> <td>J </td><td>データブロックの増分</td></tr>
         <tr> <td>K </td><td>プロット開始行</td></tr>
         <tr> <td>L </td><td>プロット開始データブロック</td></tr>
         <tr> <td>M </td><td>プロット終了行</td></tr>
         <tr> <td>N </td><td>プロット終了データブロック</td></tr>
      </table>
    </td></tr>
<tr><td> every 2       </td><td> 1行おきにプロットする</td></tr>
<tr><td> every ::3     </td><td> 3行目からプロットする</td></tr>
<tr><td> every ::3::5  </td><td> 3行目から5行目までをプロットする</td></tr>
<tr><td> every ::0::0  </td><td> 最初の行だけをプロットする</td></tr>
<tr><td> every 2::::6  </td><td> 最初の7行を1行おきにプロットする</td></tr>
<tr><td> every :2      </td><td> 1データブロックおきにプロットする</td></tr>
<tr><td> every :::5::8 </td><td> 5から8データブロックをプロットする</td></tr>
</table></div>



<p> <a name="head">データファイルの最初や最後の数行だけ</a>を切り出して
表示するだけなら(そして使っている環境がunix系のものであれば)，以下のよう
にunixのコマンド "head" や "tail" を使うこともできます．</p>

<pre class="sample">
gnuplot&gt; plot "&lt; head -10 test.dat" using 1:2 with lines
gnuplot&gt; plot "&lt; tail -3 test.dat" using 1:2 with lines
gnuplot&gt; plot "&lt; head -5 test.dat" using 1:2 with lines,\
&gt;        plot "&lt; tail -5 test.dat" using 1:2 with points
</pre>

<p> 1行目の<tt>plot</tt>例ではデータファイル "test.dat"の最初の10行だ
けをプロットします．2行目はデータファイルの最後の3行だけを表示するもの
です．4,5行目は同じファイルの最初と最後の5行づつ，最初は線で，後の5点
は記号で表示することを表します．</p>

<div align="right"><i>  from an Iwata-kun's question. Thanks !</i></div>



<div class="top"><a href="datafile2.html#top"><img src="image/mark-up.png" alt="up"></a></div>
</td></tr></table>
<hr class="topsep">


</body>
</html>

